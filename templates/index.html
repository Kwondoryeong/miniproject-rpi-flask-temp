<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>🌡️ 실시간 온습도 대시보드</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 부트스트랩 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(to right, #74ebd5, #ACB6E5);
            font-family: 'Segoe UI', sans-serif;
            color: #333;
            padding-top: 50px;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .status {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .badge-ok {
            background-color: #28a745;
        }
        .badge-warn {
            background-color: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container text-center">
        <h1 class="mb-4">🌡️ 실시간 온습도 모니터링</h1>
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card p-4">
                    <div class="card-body">
                        <h5 class="card-title">📈 현재 센서 데이터</h5>
                        <p class="card-text">🌡️ 온도: <span id="temperature">--</span> ℃</p>
                        <p class="card-text">💧 습도: <span id="humidity">--</span> %</p>
                        <p class="card-text">📅 측정 시각: <span id="timestamp">--</span></p>
                        <hr>
                        <button id="send-now-btn" class="btn btn-primary mt-3">📤 현재 온습도 전송</button>
                    </div>
                </div>

                <!-- 📜 최근 1분 로그 박스 -->
                <div class="card mt-4 p-3">
                    <h5>📜 최근 1분 센서 로그</h5>
                    <div id="log-box" style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 10px; border: 1px solid #ccc;">
                        <p>불러오는 중...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

 <!-- JavaScript (fetch + 1초마다 갱신 + 버튼 비동기 처리 + 로그 로딩) -->
    <script>
        // 날짜 포맷 함수: 2025.07.23(수) 13:52:09 GMT
        function formatDate(gmtString) {
            const date = new Date(gmtString);
            const days = ["일", "월", "화", "수", "목", "금", "토"];
            const yyyy = date.getFullYear();
            const mm = String(date.getMonth() + 1).padStart(2, "0");
            const dd = String(date.getDate()).padStart(2, "0");
            const day = days[date.getDay()];
            const hh = String(date.getHours()).padStart(2, "0");
            const mi = String(date.getMinutes()).padStart(2, "0");
            const ss = String(date.getSeconds()).padStart(2, "0");

            return `${yyyy}.${mm}.${dd}(${day}) ${hh}:${mi}:${ss} GMT`;
        }

        // 현재 데이터 로딩
        function fetchSensorData() {
            fetch("/api/data")
                .then(res => res.json())
                .then(data => {
                    document.getElementById("temperature").textContent = data.temperature ?? "--";
                    document.getElementById("humidity").textContent = data.humidity ?? "--";

                    document.getElementById("timestamp").textContent =
                        data.created_at ? formatDate(data.created_at) : "--";
                });
        }

        // 로그 로딩
        function fetchLogs() {
            fetch("/api/logs")
                .then(res => res.json())
                .then(data => {
                    const logBox = document.getElementById("log-box");
                    if (!data || data.length === 0) {
                        logBox.innerHTML = "<p>최근 1분 데이터 없음</p>";
                        return;
                    }

                    logBox.innerHTML = data.map(entry => {
                        return `<div>📅 ${formatDate(entry.created_at)} | 🌡 ${entry.temperature}°C | 💧 ${entry.humidity}%</div>`;
                    }).join("");
                })
                .catch(err => {
                    document.getElementById("log-box").innerHTML = `<p>⚠️ 오류: ${err}</p>`;
                });
        }

        // 초기 실행 및 반복
        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("send-now-btn").addEventListener("click", () => {
                fetch("/send-now", { method: "POST" })
                    .then(res => res.json())
                    .then(data => alert(data.message))
                    .catch(err => alert("오류 발생: " + err));
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>🌡️ 실시간 온습도 대시보드</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 부트스트랩 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(to right, #74ebd5, #ACB6E5);
            font-family: 'Segoe UI', sans-serif;
            color: #333;
            padding-top: 50px;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .status {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .badge-ok {
            background-color: #28a745;
        }
        .badge-warn {
            background-color: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container text-center">
        <h1 class="mb-4">🌡️ 실시간 온습도 모니터링</h1>
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card p-4">
                    <div class="card-body">
                        <h5 class="card-title">📈 현재 센서 데이터</h5>
                        <p class="card-text">🌡️ 온도: <span id="temperature">--</span> ℃</p>
                        <p class="card-text">💧 습도: <span id="humidity">--</span> %</p>
                        <p class="card-text">📅 측정 시각: <span id="timestamp">--</span></p>
                        <hr>
                        <button id="send-now-btn" class="btn btn-primary mt-3">📤 현재 온습도 전송</button>
                    </div>
                </div>

                <!-- 📜 최근 1분 로그 박스 -->
                <div class="card mt-4 p-3">
                    <h5>📜 최근 1분 센서 로그</h5>
                    <div id="log-box" style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 10px; border: 1px solid #ccc;">
                        <p>불러오는 중...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

 <!-- JavaScript (fetch + 1초마다 갱신 + 버튼 비동기 처리 + 로그 로딩) -->
    <script>
        // 날짜 포맷 함수: 2025.07.23(수) 13:52:09 GMT
        function formatDate(gmtString) {
            const date = new Date(gmtString);
            const days = ["일", "월", "화", "수", "목", "금", "토"];
            const yyyy = date.getFullYear();
            const mm = String(date.getMonth() + 1).padStart(2, "0");
            const dd = String(date.getDate()).padStart(2, "0");
            const day = days[date.getDay()];
            const hh = String(date.getHours()).padStart(2, "0");
            const mi = String(date.getMinutes()).padStart(2, "0");
            const ss = String(date.getSeconds()).padStart(2, "0");

            return `${yyyy}.${mm}.${dd}(${day}) ${hh}:${mi}:${ss} GMT`;
        }

        // 현재 데이터 로딩
        function fetchSensorData() {
            fetch("/api/data")
                .then(res => res.json())
                .then(data => {
                    document.getElementById("temperature").textContent = data.temperature ?? "--";
                    document.getElementById("humidity").textContent = data.humidity ?? "--";

                    document.getElementById("timestamp").textContent =
                        data.created_at ? formatDate(data.created_at) : "--";
                });
        }

        // 로그 로딩
        function fetchLogs() {
            fetch("/api/logs")
                .then(res => res.json())
                .then(data => {
                    const logBox = document.getElementById("log-box");
                    if (!data || data.length === 0) {
                        logBox.innerHTML = "<p>최근 1분 데이터 없음</p>";
                        return;
                    }

                    logBox.innerHTML = data.map(entry => {
                        return `<div>📅 ${formatDate(entry.created_at)} | 🌡 ${entry.temperature}°C | 💧 ${entry.humidity}%</div>`;
                    }).join("");
                })
                .catch(err => {
                    document.getElementById("log-box").innerHTML = `<p>⚠️ 오류: ${err}</p>`;
                });
        }

        // 초기 실행 및 반복
        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("send-now-btn").addEventListener("click", () => {
                fetch("/send-now", { method: "POST" })
                    .then(res => res.json())
                    .then(data => alert(data.message))
                    .catch(err => alert("오류 발생: " + err));
	    });

            fetchSensorData();
            fetchLogs();
            setInterval(fetchSensorData, 1000);  // 매초
            setInterval(fetchLogs, 6000);       // 60초마다
        });
    </script>
</body>
</html>
