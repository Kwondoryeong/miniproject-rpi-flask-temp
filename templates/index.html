<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸŒ¡ï¸ ì‹¤ì‹œê°„ ì˜¨ìŠµë„ ëŒ€ì‹œë³´ë“œ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(to right, #74ebd5, #ACB6E5);
            font-family: 'Segoe UI', sans-serif;
            color: #333;
            padding-top: 50px;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .status {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .badge-ok {
            background-color: #28a745;
        }
        .badge-warn {
            background-color: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container text-center">
        <h1 class="mb-4">ğŸŒ¡ï¸ ì‹¤ì‹œê°„ ì˜¨ìŠµë„ ëª¨ë‹ˆí„°ë§</h1>
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card p-4">
                    <div class="card-body">
                        <h5 class="card-title">ğŸ“ˆ í˜„ì¬ ì„¼ì„œ ë°ì´í„°</h5>
                        <p class="card-text">ğŸŒ¡ï¸ ì˜¨ë„: <span id="temperature">--</span> â„ƒ</p>
                        <p class="card-text">ğŸ’§ ìŠµë„: <span id="humidity">--</span> %</p>
                        <p class="card-text">ğŸ“… ì¸¡ì • ì‹œê°: <span id="timestamp">--</span></p>
                        <hr>
                        <button id="send-now-btn" class="btn btn-primary mt-3">ğŸ“¤ í˜„ì¬ ì˜¨ìŠµë„ ì „ì†¡</button>
                    </div>
                </div>

                <!-- ğŸ“œ ìµœê·¼ 1ë¶„ ë¡œê·¸ ë°•ìŠ¤ -->
                <div class="card mt-4 p-3">
                    <h5>ğŸ“œ ìµœê·¼ 1ë¶„ ì„¼ì„œ ë¡œê·¸</h5>
                    <div id="log-box" style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 10px; border: 1px solid #ccc;">
                        <p>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

 <!-- JavaScript (fetch + 1ì´ˆë§ˆë‹¤ ê°±ì‹  + ë²„íŠ¼ ë¹„ë™ê¸° ì²˜ë¦¬ + ë¡œê·¸ ë¡œë”©) -->
    <script>
        // ë‚ ì§œ í¬ë§· í•¨ìˆ˜: 2025.07.23(ìˆ˜) 13:52:09 GMT
        function formatDate(gmtString) {
            const date = new Date(gmtString);
            const days = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
            const yyyy = date.getFullYear();
            const mm = String(date.getMonth() + 1).padStart(2, "0");
            const dd = String(date.getDate()).padStart(2, "0");
            const day = days[date.getDay()];
            const hh = String(date.getHours()).padStart(2, "0");
            const mi = String(date.getMinutes()).padStart(2, "0");
            const ss = String(date.getSeconds()).padStart(2, "0");

            return `${yyyy}.${mm}.${dd}(${day}) ${hh}:${mi}:${ss} GMT`;
        }

        // í˜„ì¬ ë°ì´í„° ë¡œë”©
        function fetchSensorData() {
            fetch("/api/data")
                .then(res => res.json())
                .then(data => {
                    document.getElementById("temperature").textContent = data.temperature ?? "--";
                    document.getElementById("humidity").textContent = data.humidity ?? "--";

                    document.getElementById("timestamp").textContent =
                        data.created_at ? formatDate(data.created_at) : "--";
                });
        }

        // ë¡œê·¸ ë¡œë”©
        function fetchLogs() {
            fetch("/api/logs")
                .then(res => res.json())
                .then(data => {
                    const logBox = document.getElementById("log-box");
                    if (!data || data.length === 0) {
                        logBox.innerHTML = "<p>ìµœê·¼ 1ë¶„ ë°ì´í„° ì—†ìŒ</p>";
                        return;
                    }

                    logBox.innerHTML = data.map(entry => {
                        return `<div>ğŸ“… ${formatDate(entry.created_at)} | ğŸŒ¡ ${entry.temperature}Â°C | ğŸ’§ ${entry.humidity}%</div>`;
                    }).join("");
                })
                .catch(err => {
                    document.getElementById("log-box").innerHTML = `<p>âš ï¸ ì˜¤ë¥˜: ${err}</p>`;
                });
        }

        // ì´ˆê¸° ì‹¤í–‰ ë° ë°˜ë³µ
        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("send-now-btn").addEventListener("click", () => {
                fetch("/send-now", { method: "POST" })
                    .then(res => res.json())
                    .then(data => alert(data.message))
                    .catch(err => alert("ì˜¤ë¥˜ ë°œìƒ: " + err));
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸŒ¡ï¸ ì‹¤ì‹œê°„ ì˜¨ìŠµë„ ëŒ€ì‹œë³´ë“œ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(to right, #74ebd5, #ACB6E5);
            font-family: 'Segoe UI', sans-serif;
            color: #333;
            padding-top: 50px;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .status {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .badge-ok {
            background-color: #28a745;
        }
        .badge-warn {
            background-color: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container text-center">
        <h1 class="mb-4">ğŸŒ¡ï¸ ì‹¤ì‹œê°„ ì˜¨ìŠµë„ ëª¨ë‹ˆí„°ë§</h1>
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card p-4">
                    <div class="card-body">
                        <h5 class="card-title">ğŸ“ˆ í˜„ì¬ ì„¼ì„œ ë°ì´í„°</h5>
                        <p class="card-text">ğŸŒ¡ï¸ ì˜¨ë„: <span id="temperature">--</span> â„ƒ</p>
                        <p class="card-text">ğŸ’§ ìŠµë„: <span id="humidity">--</span> %</p>
                        <p class="card-text">ğŸ“… ì¸¡ì • ì‹œê°: <span id="timestamp">--</span></p>
                        <hr>
                        <button id="send-now-btn" class="btn btn-primary mt-3">ğŸ“¤ í˜„ì¬ ì˜¨ìŠµë„ ì „ì†¡</button>
                    </div>
                </div>

                <!-- ğŸ“œ ìµœê·¼ 1ë¶„ ë¡œê·¸ ë°•ìŠ¤ -->
                <div class="card mt-4 p-3">
                    <h5>ğŸ“œ ìµœê·¼ 1ë¶„ ì„¼ì„œ ë¡œê·¸</h5>
                    <div id="log-box" style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 10px; border: 1px solid #ccc;">
                        <p>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

 <!-- JavaScript (fetch + 1ì´ˆë§ˆë‹¤ ê°±ì‹  + ë²„íŠ¼ ë¹„ë™ê¸° ì²˜ë¦¬ + ë¡œê·¸ ë¡œë”©) -->
    <script>
        // ë‚ ì§œ í¬ë§· í•¨ìˆ˜: 2025.07.23(ìˆ˜) 13:52:09 GMT
        function formatDate(gmtString) {
            const date = new Date(gmtString);
            const days = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
            const yyyy = date.getFullYear();
            const mm = String(date.getMonth() + 1).padStart(2, "0");
            const dd = String(date.getDate()).padStart(2, "0");
            const day = days[date.getDay()];
            const hh = String(date.getHours()).padStart(2, "0");
            const mi = String(date.getMinutes()).padStart(2, "0");
            const ss = String(date.getSeconds()).padStart(2, "0");

            return `${yyyy}.${mm}.${dd}(${day}) ${hh}:${mi}:${ss} GMT`;
        }

        // í˜„ì¬ ë°ì´í„° ë¡œë”©
        function fetchSensorData() {
            fetch("/api/data")
                .then(res => res.json())
                .then(data => {
                    document.getElementById("temperature").textContent = data.temperature ?? "--";
                    document.getElementById("humidity").textContent = data.humidity ?? "--";

                    document.getElementById("timestamp").textContent =
                        data.created_at ? formatDate(data.created_at) : "--";
                });
        }

        // ë¡œê·¸ ë¡œë”©
        function fetchLogs() {
            fetch("/api/logs")
                .then(res => res.json())
                .then(data => {
                    const logBox = document.getElementById("log-box");
                    if (!data || data.length === 0) {
                        logBox.innerHTML = "<p>ìµœê·¼ 1ë¶„ ë°ì´í„° ì—†ìŒ</p>";
                        return;
                    }

                    logBox.innerHTML = data.map(entry => {
                        return `<div>ğŸ“… ${formatDate(entry.created_at)} | ğŸŒ¡ ${entry.temperature}Â°C | ğŸ’§ ${entry.humidity}%</div>`;
                    }).join("");
                })
                .catch(err => {
                    document.getElementById("log-box").innerHTML = `<p>âš ï¸ ì˜¤ë¥˜: ${err}</p>`;
                });
        }

        // ì´ˆê¸° ì‹¤í–‰ ë° ë°˜ë³µ
        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("send-now-btn").addEventListener("click", () => {
                fetch("/send-now", { method: "POST" })
                    .then(res => res.json())
                    .then(data => alert(data.message))
                    .catch(err => alert("ì˜¤ë¥˜ ë°œìƒ: " + err));
	    });

            fetchSensorData();
            fetchLogs();
            setInterval(fetchSensorData, 1000);  // ë§¤ì´ˆ
            setInterval(fetchLogs, 6000);       // 60ì´ˆë§ˆë‹¤
        });
    </script>
</body>
</html>
